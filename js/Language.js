const e=new Map([["en-us","English (American)"],["ru-ru","русский"],["zh-cn","中文"]]);let t="en-us";export default class a{constructor(e){this.dictionary,this.used,this.select=e}handleSelect(a,s){let n,r;const o=new URLSearchParams(window.location.search);for(const[t,a]of e){const e=new Option(a,t);this.select.appendChild(e)}const i=[...e.keys()];if(o.has("lang")&&e.has(o.get("lang"))){const e=o.get("lang");r=e,localStorage.setItem("lang",e)}else localStorage.getItem("lang")?r=localStorage.getItem("lang"):(e.has(navigator.language.toLowerCase())?t=navigator.language:i.some(e=>e.startsWith(navigator.language.split("-")[0]))?t=i.find(e=>e.startsWith(navigator.language.split("-")[0])):navigator.languages&&(t=navigator.languages.find(t=>e.has(t.toLowerCase()))||i.find(e=>navigator.languages.some(t=>e.startsWith(t.split("-")[0])))||t),t=t.toLowerCase(),r=t);return n=fetch(`./lang/${r}.json`).then(e=>e.json()),this.select.value=r,this.used=r,void 0!==s&&(a=a.bind(s)),this.select.addEventListener("change",async e=>{const t=e.target.value;localStorage.setItem("lang",t),this.used=t,this.loadDictionary(await fetch(`./lang/${t}.json`).then(e=>e.json())),a(t)}),n}loadDictionary(e){for(const t in e){const s=e[t];if("string"==typeof s){a.LOCATEREGEX.lastIndex=0;const[,...n]=a.LOCATEREGEX.exec(s)||[];if(0===n.length)continue;e[t]=e=>a.refFormat(a.replaceFormat(s,e.rep),e.ref)}else this.loadDictionary(s)}this.dictionary=e}get(e=""){const t=e.split(".");let a=this.dictionary;for(const e of t)a=a[e];return a}static replaceFormat(e,t){for(const a in t)e=e.replace(new RegExp(`%{${a}}`,"g"),t[a]);return e}static refFormat(e,t){a.REFREGEX.lastIndex=0;const[,...s]=a.REFREGEX.exec(e)||[];if(Array.isArray(t)&&s.length!==t.length)throw new Error("The array should have the same amount of functions as the lang text has variable as!");for(let a=0;a<s.length;a++)e=e.replace(new RegExp(`&{${s[a]}}`),t[a](s[a]));return e}}a.LOCATEREGEX=/(%|&){(.+)}/g,a.REFREGEX=/&{(.+)}/g,a.ref=new Map([["system.credits.p2",{ref:[e=>`<a href="https://github.com/r-paydaybuilds/pd2builder/blob/master/CONTRIBUTORS.md">${e}</a>`]}],["system.credits.license",{ref:[e=>`<a href="https://opensource.org/licenses/MIT">${e}</a>`]}]]);
